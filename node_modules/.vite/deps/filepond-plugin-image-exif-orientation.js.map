{
  "version": 3,
  "sources": ["../../filepond-plugin-image-exif-orientation/dist/filepond-plugin-image-exif-orientation.esm.js"],
  "sourcesContent": ["/*!\n * FilePondPluginImageExifOrientation 1.0.11\n * Licensed under MIT, https://opensource.org/licenses/MIT/\n * Please visit https://pqina.nl/filepond/ for details.\n */\n\n/* eslint-disable */\n\n// test if file is of type image\nconst isJPEG = file => /^image\\/jpeg/.test(file.type);\n\nconst Marker = {\n  JPEG: 0xffd8,\n  APP1: 0xffe1,\n  EXIF: 0x45786966,\n  TIFF: 0x4949,\n  Orientation: 0x0112,\n  Unknown: 0xff00\n};\n\nconst getUint16 = (view, offset, little = false) =>\n  view.getUint16(offset, little);\nconst getUint32 = (view, offset, little = false) =>\n  view.getUint32(offset, little);\n\nconst getImageOrientation = file =>\n  new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = function(e) {\n      const view = new DataView(e.target.result);\n\n      // Every JPEG file starts from binary value '0xFFD8'\n      if (getUint16(view, 0) !== Marker.JPEG) {\n        // This aint no JPEG\n        resolve(-1);\n        return;\n      }\n\n      const length = view.byteLength;\n      let offset = 2;\n\n      while (offset < length) {\n        const marker = getUint16(view, offset);\n        offset += 2;\n\n        // There's our APP1 Marker\n        if (marker === Marker.APP1) {\n          if (getUint32(view, (offset += 2)) !== Marker.EXIF) {\n            // no EXIF info defined\n            break;\n          }\n\n          // Get TIFF Header\n          const little = getUint16(view, (offset += 6)) === Marker.TIFF;\n          offset += getUint32(view, offset + 4, little);\n\n          const tags = getUint16(view, offset, little);\n          offset += 2;\n\n          for (let i = 0; i < tags; i++) {\n            // found the orientation tag\n            if (\n              getUint16(view, offset + i * 12, little) === Marker.Orientation\n            ) {\n              resolve(getUint16(view, offset + i * 12 + 8, little));\n              return;\n            }\n          }\n        } else if ((marker & Marker.Unknown) !== Marker.Unknown) {\n          // Invalid\n          break;\n        } else {\n          offset += getUint16(view, offset);\n        }\n      }\n\n      // Nothing found\n      resolve(-1);\n    };\n\n    // we don't need to read the entire file to get the orientation\n    reader.readAsArrayBuffer(file.slice(0, 64 * 1024));\n  });\n\nconst IS_BROWSER = (() =>\n  typeof window !== 'undefined' && typeof window.document !== 'undefined')();\nconst isBrowser = () => IS_BROWSER;\n\n// 2x1 pixel image 90CW rotated with orientation header\nconst testSrc =\n  'data:image/jpg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4QA6RXhpZgAATU0AKgAAAAgAAwESAAMAAAABAAYAAAEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAD/2wBDAP//////////////////////////////////////////////////////////////////////////////////////wAALCAABAAIBASIA/8QAJgABAAAAAAAAAAAAAAAAAAAAAxABAAAAAAAAAAAAAAAAAAAAAP/aAAgBAQAAPwBH/9k=';\n\n// should correct orientation if is presented in landscape, in which case the browser doesn't autocorrect\nlet shouldCorrect = undefined;\nconst testImage = isBrowser() ? new Image() : {};\ntestImage.onload = () =>\n  (shouldCorrect = testImage.naturalWidth > testImage.naturalHeight);\ntestImage.src = testSrc;\n\nconst shouldCorrectImageExifOrientation = () => shouldCorrect;\n\n/**\n * Read Image Orientation Plugin\n */\nconst plugin = ({ addFilter, utils }) => {\n  const { Type, isFile } = utils;\n\n  // subscribe to file load and append required info\n  addFilter(\n    'DID_LOAD_ITEM',\n    (item, { query }) =>\n      new Promise((resolve, reject) => {\n        // get file reference\n        const file = item.file;\n\n        // if this is not a jpeg image we are not interested\n        if (\n          !isFile(file) ||\n          !isJPEG(file) ||\n          !query('GET_ALLOW_IMAGE_EXIF_ORIENTATION') ||\n          !shouldCorrectImageExifOrientation()\n        ) {\n          // continue with the unaltered dataset\n          return resolve(item);\n        }\n\n        // get orientation from exif data\n        getImageOrientation(file).then(orientation => {\n          item.setMetadata('exif', { orientation });\n          resolve(item);\n        });\n      })\n  );\n\n  // Expose plugin options\n  return {\n    options: {\n      // Enable or disable image orientation reading\n      allowImageExifOrientation: [true, Type.BOOLEAN]\n    }\n  };\n};\n\n// fire pluginloaded event if running in browser, this allows registering the plugin when using async script tags\nconst isBrowser$1 =\n  typeof window !== 'undefined' && typeof window.document !== 'undefined';\nif (isBrowser$1) {\n  document.dispatchEvent(\n    new CustomEvent('FilePond:pluginloaded', { detail: plugin })\n  );\n}\n\nexport default plugin;\n"],
  "mappings": "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",
  "names": []
}
